#!/bin/bash

# Create user rushi and set password
useradd -m rushi
echo "rushi:Rushi@123" | chpasswd

# Add rushi to sudoers with NOPASSWD
echo "rushi ALL=(ALL) NOPASSWD:ALL" > /etc/sudoers.d/rushi
chmod 440 /etc/sudoers.d/rushi

# Enable PasswordAuthentication in sshd_config
sed -i 's/^#PasswordAuthentication no/PasswordAuthentication yes/' /etc/ssh/sshd_config
sed -i 's/^PasswordAuthentication no/PasswordAuthentication yes/' /etc/ssh/sshd_config
if ! grep -q "^PasswordAuthentication" /etc/ssh/sshd_config; then
  echo "PasswordAuthentication yes" >> /etc/ssh/sshd_config
fi

# Restart SSH service
if command -v systemctl >/dev/null; then
  systemctl restart sshd
else
  service ssh restart
fi
